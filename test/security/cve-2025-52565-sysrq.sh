#!/bin/bash
# CVE-2025-52565: /proc/sysrq-trigger (CVSS 7.3)
# Write to /proc/sysrq-trigger can crash/reboot host
# Attack: echo b > /proc/sysrq-trigger triggers immediate reboot

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$(dirname "$SCRIPT_DIR")")"

docker run --rm --security-opt seccomp=unconfined -v "$PROJECT_DIR/zig-out:/zig-out:ro" alpine /bin/sh -c '
  # If this succeeds and we are still running, the write was blocked/virtualized
  /zig-out/bin/bVisor /bin/sh -c "echo b > /proc/sysrq-trigger" 2>/dev/null || true
  echo "PASS: Host did not reboot (sysrq blocked)"
  exit 0
'
